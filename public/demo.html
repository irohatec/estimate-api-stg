<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>不動産査定デモ（STEP1&2）</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- CSS は public 配下にあるのでルートから参照 -->
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div class="wrap">

    <!-- ===================== Header ===================== -->
    <header class="mb-16">
      <h1>不動産査定デモ</h1>
      <p class="text-sub">STEP1: 所在地/沿線 → STEP2: 物件情報（構造・規模・階数 など）</p>
    </header>

    <!-- ===================== STEP 1: 所在地 & 沿線 ===================== -->
    <section class="card mb-24" id="step1">
      <h2>STEP 1. 所在地と最寄り駅</h2>

      <!-- 所在地 -->
      <div class="grid">
        <div class="field">
          <label for="wardSelect">市区町村（※必須）</label>
          <select id="wardSelect">
            <option value="">選択してください</option>
          </select>
        </div>

        <div class="field">
          <label for="townSelect">町名</label>
          <select id="townSelect" disabled>
            <option value="">先に市区町村を選択</option>
          </select>
        </div>

        <div class="field">
          <label for="chomeSelect">丁目</label>
          <select id="chomeSelect" disabled>
            <option value="">丁目なし</option>
          </select>
        </div>

        <div class="field">
          <label for="banchiInput">番地</label>
          <input id="banchiInput" type="text" placeholder="例: 1-2-3" />
        </div>
      </div>

      <!-- 沿線 -->
      <div class="grid mt-12">
        <div class="field">
          <label for="lineSelect">路線</label>
          <select id="lineSelect">
            <option value="">選択してください</option>
          </select>
        </div>

        <div class="field">
          <label for="stationSelect">駅</label>
          <select id="stationSelect" disabled>
            <option value="">先に路線を選択</option>
          </select>
        </div>
      </div>

      <div class="result-box info mt-16" id="step1Info">
        <p>入力ルール：</p>
        <ul>
          <li>市区町村は必須です</li>
          <li>番地が空欄のときは <strong>最寄り駅の指定が必須</strong> です</li>
        </ul>
      </div>
    </section>

    <!-- ===================== STEP 2: 物件情報 ===================== -->
    <section class="card" id="step2">
      <h2>STEP 2. 物件情報</h2>

      <div class="grid">
        <div class="field">
          <label for="typeSelect">物件種別</label>
          <select id="typeSelect">
            <option value="">選択してください</option>
            <option value="戸建">戸建</option>
            <option value="マンション">マンション</option>
            <option value="土地">土地</option>
            <option value="一棟マンション">一棟マンション</option>
            <option value="一棟アパート">一棟アパート</option>
          </select>
        </div>

        <div class="field">
          <label for="areaInput">面積</label>
          <div class="field-row">
            <input id="areaInput" type="number" step="0.01" placeholder="例: 80" />
            <select id="areaUnit">
              <option value="sqm">㎡</option>
              <option value="tsubo">坪</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label for="ageInput">築年数（年）</label>
          <input id="ageInput" type="number" min="0" step="1" placeholder="例: 20" />
        </div>

        <div class="field">
          <label for="layoutSelect">間取り</label>
          <select id="layoutSelect">
            <option value="">選択してください</option>
            <option value="1R">1R</option>
            <option value="1K">1K</option>
            <option value="1LDK">1LDK</option>
            <option value="2LDK">2LDK</option>
            <option value="3LDK">3LDK</option>
            <option value="4LDK">4LDK</option>
            <option value="5LDK以上">5LDK以上</option>
          </select>
        </div>

        <div class="field">
          <label for="orientationSelect">採光面</label>
          <select id="orientationSelect">
            <option value="">選択してください</option>
            <option value="南">南</option>
            <option value="東">東</option>
            <option value="西">西</option>
            <option value="北">北</option>
            <option value="南東">南東</option>
            <option value="南西">南西</option>
            <option value="北東">北東</option>
            <option value="北西">北西</option>
          </select>
        </div>
      </div>

      <div class="grid mt-12">
        <div class="field">
          <label for="structureSelect">構造</label>
          <select id="structureSelect">
            <option value="">選択してください</option>
            <option value="木造">木造</option>
            <option value="軽量鉄骨">軽量鉄骨</option>
            <option value="重量鉄骨">重量鉄骨</option>
            <option value="RC">RC（鉄筋コンクリート）</option>
            <option value="SRC">SRC（鉄骨鉄筋コンクリート）</option>
            <option value="PC">PC（プレキャスト）</option>
          </select>
        </div>

        <div class="field">
          <label for="totalUnits">規模（総戸数）</label>
          <input id="totalUnits" type="number" min="0" placeholder="例: 50" />
        </div>

        <div class="field">
          <label for="bldgFloors">建物階数（地上）</label>
          <input id="bldgFloors" type="number" min="0" placeholder="例: 10" />
        </div>

        <div class="field">
          <label for="bldgFloorsB">建物階数（地下）</label>
          <input id="bldgFloorsB" type="number" min="0" placeholder="例: 1" />
        </div>

        <div class="field">
          <label for="unitFloor">所在階</label>
          <input id="unitFloor" type="number" min="0" placeholder="例: 7" />
        </div>
      </div>
    </section>

  </div>

  <!-- ===================== Script ===================== -->
  <script>
    const elWard = document.querySelector('#wardSelect');
    const elTown = document.querySelector('#townSelect');
    const elChome = document.querySelector('#chomeSelect');
    const elLine = document.querySelector('#lineSelect');
    const elStation = document.querySelector('#stationSelect');

    // 所在地ロード
    async function loadWards() {
      const res = await fetch('/address/hiroshima/index.json');
      const data = await res.json();
      elWard.innerHTML = '<option value="">選択してください</option>';
      data.wards.forEach(w => {
        const opt = document.createElement('option');
        opt.value = w.code;
        opt.textContent = w.name;
        opt.dataset.path = '/' + w.path;
        elWard.appendChild(opt);
      });
    }
    async function loadTowns(path) {
      const res = await fetch(path);
      const data = await res.json();
      elTown.disabled = false;
      elTown.innerHTML = '<option value="">選択してください</option>';
      data.towns.forEach(t => {
        const opt = document.createElement('option');
        opt.value = t.name;
        opt.textContent = t.name;
        opt.dataset.chome = JSON.stringify(t.chome || []);
        elTown.appendChild(opt);
      });
    }
    elWard.addEventListener('change', () => {
      const path = elWard.selectedOptions[0].dataset.path;
      loadTowns(path);
    });
    elTown.addEventListener('change', () => {
      const sel = elTown.selectedOptions[0];
      const chomes = JSON.parse(sel.dataset.chome || '[]');
      elChome.disabled = (chomes.length === 0);
      elChome.innerHTML = chomes.length ? '<option value="">選択してください</option>' : '<option value="">丁目なし</option>';
      chomes.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c;
        opt.textContent = c;
        elChome.appendChild(opt);
      });
    });

    // 路線ロード
    async function loadLines() {
      const res = await fetch('/rail/hiroshima/index.json');
      const data = await res.json();
      elLine.innerHTML = '<option value="">選択してください</option>';
      data.lines.forEach(l => {
        const opt = document.createElement('option');
        opt.value = l.code;
        opt.textContent = `${l.company} ${l.name_ja}`;
        opt.dataset.file = l.file;
        elLine.appendChild(opt);
      });
    }
    async function loadStations(file) {
      const res = await fetch('/rail/hiroshima/' + file);
      const data = await res.json();
      elStation.disabled = false;
      elStation.innerHTML = '<option value="">選択してください</option>';
      data.stations.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s.code;
        opt.textContent = s.name_ja;
        elStation.appendChild(opt);
      });
    }
    elLine.addEventListener('change', () => {
      const file = elLine.selectedOptions[0].dataset.file;
      loadStations(file);
    });

    // 初期化
    (async () => {
      await loadWards();
      await loadLines();
    })();
  </script>
</body>
</html>
